---
title: "Assignment2_RMD"
output: html_document
---

Assignment2 is to redo the analysis of Assignment1 using R exclusively
1. Read in bed files
2. Find overlapping genes
3. Generate TSS and add 5kbp around each TSS
4. Find overlapping marks and TSS
5. Find overlapping marks
6. Generate pie charts

```{r message=FALSE}
##Loading Libraries
library(GenomicRanges)
library(rtracklayer)
library(RColorBrewer)
library(compare)
library(GenomicFeatures)
library(TxDb.Mmusculus.UCSC.mm9.knownGene)
library(IRanges)
```

```{r}
##Load bed files
k27ac <- import.bedGraph(con="K27Ac_D7_Th1-W200-G200-E200-island.bedgraph", asRangedData=FALSE)
k4m3 <- import.bedGraph(con="K4m3_Th1_72h-W200-G200-E200-island.bedgraph", asRangedData=FALSE)
refgene <- import.bed(con="mm9_RefSeq.bed", asRangedData=FALSE)
sort1 <- import.bed("1sort.bed")
sort2 <- import.bed("2sort.bed")
```

```{r}
#Subsetting the overlapping genes and counting unique genes
k27ac.gene.overlaps <- subsetByOverlaps(refgene, k27ac)
list1 <- sort(unique(k27ac.gene.overlaps$name))
length(intersect(list1,sort1$name))/length(list1)

k4m3.gene.overlaps <- subsetByOverlaps(refgene, k4m3)
list2 <- sort(unique(k4m3.gene.overlaps$name))
length(intersect(list2,sort2$name))/length(list2)
```

```{r}
##Creating tss start sites and finding histone mark overlaps
tss <- flank(refgene, width = 5000, both=TRUE, start=TRUE)
k27ac.tss.overlaps <- subsetByOverlaps(tss, k27ac)
k27ac.tss <- subsetByOverlaps(k27ac, tss)
list3 <- sort(unique(k27ac.tss.overlaps$name))
k4m3.tss.overlaps <- subsetByOverlaps(tss, k4m3)
k4m3.tss <- subsetByOverlaps(k4m3, tss)
list4 <- sort(unique(k4m3.tss.overlaps$name))
```

```{r}
##Finding overlaps between histone marks
k27ac.overlaps <- subsetByOverlaps(k4m3, k27ac)
k4m3.overlaps <- subsetByOverlaps(k27ac, k4m3)
```

```{r}
##Calculating percentages
ans3 <- sum(width(reduce(k27ac.tss, ignore.strand=TRUE)))/sum(width(k27ac))
ans4 <- sum(width(reduce(k4m3.tss, ignore.strand=TRUE)))/sum(width(k4m3))
ans5 <- sum(width(reduce(k27ac.overlaps, ignore.strand=TRUE)))/sum(width(k4m3))
ans6 <- sum(width(reduce(k4m3.overlaps, ignore.strand=TRUE)))/sum(width(k27ac))
```

Bar Charts:

```{r echo=FALSE}
##Creating Graphs
barplot(c(ans3*100, ans4*100), main="Percentage of Histone Marks within 5kpb of TSS", 
    xlab="Histone Modification", names.arg=c("H3K4me3", "H3K27ac"), ylim=c(0,100))
barplot(c(ans5*100, ans6*100), main="Percentage of Histone Marks Overlapping", 
    xlab="Histone Modification", names.arg=c("H3K4me3", "H3K27ac"), ylim=c(0,100))
```

Figure 1. A shows the percentage of H3K4Me3 marks within 5 kbp on either side of the transcription start sites of every gene over the entire H3K4Me3 coverage of the genome. B shows the percentage of H3K27ac marks within 5 kbp on either side of the transcription start sites of every gene over the entire H3K27ac coverage of the genome. C shows the percentage of H3K4me3 coverage that overlaps the coverage of H3K27ac and D shows the percentage of H3K27ac coverage over the entire coverage of H3K4me3.
